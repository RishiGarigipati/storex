flowchart TD
    %% Define styles for different node types
    classDef clientNode fill:#0078D4,stroke:#005a9e,color:white,stroke-width:2px,rx:25,ry:25;
    classDef providerNode fill:#4CAF50,stroke:#3d8b40,color:white,stroke-width:2px,rx:25,ry:25;
    classDef processNode fill:#f0f0f0,stroke:#d0d0d0,color:#333,stroke-width:2px,rx:10,ry:10;
    classDef azureNode fill:#0078D4,stroke:#005a9e,color:white,stroke-width:2px,rx:5,ry:5;
    classDef dataNode fill:#FFB900,stroke:#d09000,color:white,stroke-width:2px,rx:15,ry:15;
    classDef verifyNode fill:#E74856,stroke:#c5303e,color:white,stroke-width:2px,rx:8,ry:8;
    classDef paymentNode fill:#00B294,stroke:#008975,color:white,stroke-width:2px,rx:12,ry:12;
    
    %% Main actors
    Client["👤 Client<br>Seeking Storage"]:::clientNode
    Provider["💾 Storage Provider<br>With Unused Capacity"]:::providerNode
    
    %% Azure infrastructure
    AzureBlockchain["⛓️ Azure Blockchain<br>as a Service"]:::azureNode
    AzureConfidential["🔐 Azure Confidential<br>Ledger"]:::azureNode
    AzureServices["☁️ Azure Services<br>Ecosystem"]:::azureNode
    
    %% Marketplace processes
    MarketplaceEntry["🏢 Marketplace Entry"]:::processNode
    DealCreation["📝 Deal Creation"]:::processNode
    BiddingProcess["🔄 Bidding Process"]:::processNode
    DealSelection["✅ Deal Selection"]:::processNode
    SmartContract["📜 Smart Contract<br>Execution"]:::processNode
    
    %% Data and verification
    DataStorage["📦 Data Storage"]:::dataNode
    StorageVerification["🔍 Storage Verification"]:::verifyNode
    PoRep["🧩 Proof of Replication<br>(PoRep)"]:::verifyNode
    PoSt["⏱️ Proof of Spacetime<br>(PoSt)"]:::verifyNode
    
    %% Payment and integration
    PaymentProcessing["💰 Payment Processing"]:::paymentNode
    SecurityCompliance["🛡️ Security & Compliance<br>Frameworks"]:::azureNode
    
    %% Flow connections
    Client --> MarketplaceEntry
    Provider --> MarketplaceEntry
    
    MarketplaceEntry --> DealCreation
    DealCreation -->|"Client specifies:<br>• Data amount<br>• Duration<br>• Price"| BiddingProcess
    
    BiddingProcess -->|"Providers compete<br>with bids"| DealSelection
    DealSelection -->|"Best offer<br>selected"| SmartContract
    
    AzureBlockchain -->|"Powers"| SmartContract
    SmartContract -->|"Defines terms<br>& conditions"| DataStorage
    
    DataStorage -->|"Initiates"| StorageVerification
    StorageVerification --> PoRep
    StorageVerification --> PoSt
    
    PoRep -->|"Verifies initial<br>storage"| AzureConfidential
    PoSt -->|"Verifies ongoing<br>storage"| AzureConfidential
    
    AzureConfidential -->|"Records all<br>transactions"| PaymentProcessing
    PaymentProcessing -->|"Compensates<br>providers"| Provider
    
    PaymentProcessing -->|"Charges"| Client
    
    AzureServices -->|"Integrates with"| SecurityCompliance
    SecurityCompliance -->|"Applies to"| DataStorage
    
    %% Subgraphs for organization
    subgraph "Marketplace Dynamics"
        MarketplaceEntry
        DealCreation
        BiddingProcess
        DealSelection
    end
    
    subgraph "Azure Infrastructure"
        AzureBlockchain
        AzureConfidential
        AzureServices
        SecurityCompliance
    end
    
    subgraph "Verification Mechanisms"
        StorageVerification
        PoRep
        PoSt
    end